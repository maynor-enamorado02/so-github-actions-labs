
name: System Automation Workflow

on:
  workflow_dispatch:
    branches:
      - main

jobs:
  system-automation:
    runs-on: ubuntu-latest

    steps:
      # 1. Clonar el repositorio
      - name: Checkout repository
        uses: actions/checkout@v3

      # 2. Configurar variables y secretos
      - name: Set environment variables
        run: |
          echo "MY_VAR=HelloWorld" >> $GITHUB_ENV
        env:
          SECRET_TOKEN: ${{ secrets.SECRET_TOKEN }}

      # 3. Ejecutar script Bash
      - name: Run automation script
        run: |
          set -e  # Detener si hay error
          echo "=== Inicio del script ==="
          
          # Leer y escribir archivos
          echo "Escribiendo archivo..."
          echo "Contenido generado por workflow" > output.txt
          
          # Cambiar permisos
          chmod 755 output.txt
          
          # Crear proceso en segundo plano
          (sleep 5 && echo "Proceso en segundo plano completado") &
          
          # Usar variable de entorno y secreto
          echo "Variable: $MY_VAR"
          echo "Secreto: $SECRET_TOKEN"
          
          # Verificar archivo
          cat output.txt
          
          echo "=== Fin del script ==="
        shell: bash

      # 4. Subir artifact
      - name: Upload artifact
        uses: actions/upload-artifact@v3
        with:
          name: output-files

