
name: System Automation Workflow

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  automation-job:
    runs-on: windows-latest

    steps:
      # 1) Clonar repo
      - name: Checkout
        uses: actions/checkout@v4

      # 2) Variables de entorno
      - name: Set environment variables
        shell: pwsh
        run: |
          "MY_ENV_VAR=HelloWorld" | Out-File -FilePath $env:GITHUB_ENV -Append

      # 3) Script PowerShell con manejo de errores
      - name: Run PowerShell with error handling
        shell: pwsh
        run: |
          try {
            # Leer/escribir archivos
            $filePath = "output.txt"
            "Archivo generado por el workflow. Var: $env:MY_ENV_VAR" | Out-File $filePath -Encoding UTF8

            # Permisos (icacls en Windows)
            icacls $filePath /grant Everyone:(F) | Out-Null

            # Proceso en segundo plano (ejemplo: ping oculto)
            Start-Process -FilePath "powershell.exe" -ArgumentList "Start-Sleep -Seconds 5" -WindowStyle Hidden

            # Confirmaci√≥n
            Write-Host "OK: script terminado"
          }
          catch {
            Write-Host "ERROR: $($_.Exception.Message)"
            exit 1
          }

      # 4) Subir artifact (v4)
      - name: Upload artifact (v4)
        uses: actions/upload-artifact@v4
        with:
          name: system-automation-windows
          path: |
            output.txt
        

